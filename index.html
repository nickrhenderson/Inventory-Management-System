<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Inventory System</title>
    <style>
        /* Critical styles to prevent FOUC - must be inline and first */
        /* Hide all body content by default until loaded */
        body:not(.loaded) {
            visibility: hidden !important;
            overflow: hidden !important;
        }
        
        /* Show only the loading screen initially */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f0f0f0;
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: Arial, sans-serif;
            visibility: visible !important;
        }
        
        .loading-content {
            text-align: center;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #007acc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        .loading-text {
            color: #666;
            font-size: 18px;
            font-weight: 500;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* When loaded, hide loading screen and show content */
        body.loaded {
            visibility: visible !important;
            overflow: visible !important;
        }
        
        body.loaded #loading-screen {
            display: none !important;
        }
    </style>
    <link rel="stylesheet" href="static/styles.css">
    <script src="static/main.js" defer></script>
    <script>
        // Track when the page started loading
        const pageLoadStart = Date.now();
        
        // Global flag to track when initial loading screen is complete
        window.loadingScreenComplete = false;
        
        // Function to trigger all pending animations
        window.triggerPendingAnimations = function() {
            console.log('Triggering pending animations...');
            
            // Trigger product animations if pending
            if (window.pendingProductAnimation) {
                window.pendingProductAnimation();
                window.pendingProductAnimation = null;
            }
            
            // Trigger ingredient animations if pending
            if (window.pendingIngredientAnimation) {
                window.pendingIngredientAnimation();
                window.pendingIngredientAnimation = null;
            }
        };
        
        // Wait for styles.css to load, then show the app (with minimum 3 second delay)
        document.addEventListener('DOMContentLoaded', function() {
            const styleLink = document.querySelector('link[href*="styles.css"]');
            if (styleLink) {
                styleLink.addEventListener('load', function() {
                    showAppAfterMinimumDelay();
                });
            } else {
                // Fallback if link not found
                setTimeout(function() {
                    showAppAfterMinimumDelay();
                }, 100);
            }
        });
        
        // Function to show app after ensuring minimum 3 second loading time
        function showAppAfterMinimumDelay() {
            const elapsed = Date.now() - pageLoadStart;
            const remaining = Math.max(0, 3000 - elapsed);
            
            setTimeout(function() {
                // Add loaded class to body to trigger visibility and hide loading screen
                document.body.classList.add('loaded');
                window.loadingScreenComplete = true;
                
                // Trigger any pending animations that were waiting for the loading screen
                if (window.triggerPendingAnimations) {
                    window.triggerPendingAnimations();
                }
                
                console.log('App ready after minimum loading time');
            }, remaining);
        }
        
        // Fallback in case DOMContentLoaded doesn't fire
        window.addEventListener('load', function() {
            const elapsed = Date.now() - pageLoadStart;
            const remaining = Math.max(0, 3000 - elapsed);
            
            setTimeout(function() {
                // Add loaded class to body to trigger visibility and hide loading screen
                document.body.classList.add('loaded');
                window.loadingScreenComplete = true;
                
                // Trigger any pending animations that were waiting for the loading screen
                if (window.triggerPendingAnimations) {
                    window.triggerPendingAnimations();
                }
            }, remaining);
        });
    </script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading Inventory System...</div>
        </div>
    </div>
    
    <!-- Top Navigation Bar -->
    <header class="top-bar">
        <div class="search-container">
            <input class="search-bar" type="text" placeholder="Search..." autocomplete="off">
            <div class="search-icon">
                <img src="static/img/svg/magnifyglass.svg" alt="Search" />
            </div>
        </div>
        <button class="top-bar-button version-button" title="Version" id="versionButton">
            v0.3.3
        </button>
    </header>
    
    <!-- Main Application Content -->
    <main class="main">
        <!-- Products Panel -->
        <section class="box left">
            <div class="inventory-container">
                <div id="inventoryTable"></div>
            </div>
        </section>
        
        <!-- Ingredients Panel -->
        <section class="box right">
            <div class="ingredients-container">
                <div id="rightBoxContent"></div>
            </div>
            <footer class="ingredients-total-fixed" id="ingredientsTotalFixed"></footer>
        </section>
    </main>
    
    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="openProductModal(); hideContextMenu()">
            <img src="static/img/svg/plus.svg" alt="Add" class="menu-icon" />
            <span>Add Product</span>
        </div>
        <div class="context-menu-item" onclick="openIngredientModal(); hideContextMenu()">
            <img src="static/img/svg/plus.svg" alt="Add" class="menu-icon" />
            <span>Add Ingredient</span>
        </div>
        <div class="context-menu-item" onclick="openGroupModal(); hideContextMenu()">
            <img src="static/img/svg/plus.svg" alt="Add" class="menu-icon" />
            <span>Create Group</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" onclick="refreshFiles(); hideContextMenu()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="menu-icon">
                <path d="M21 3V8M21 8H16M21 8L18 5.29168C16.4077 3.86656 14.3051 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21C16.2832 21 19.8675 18.008 20.777 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Refresh</span>
        </div>
    </div>
    
    <!-- Modals -->
    <!-- Product Creation Modal -->
    <div class="modal-backdrop creation-modal-backdrop" id="productModalBackdrop" onclick="closeProductModal()">
        <div class="modal-content creation-modal" id="productModal" onclick="event.stopPropagation()">
            <button class="modal-close-button" onclick="closeProductModal()" title="Close">×</button>
            <h3>Add New Product</h3>
            <form id="productForm">
                <div class="form-group">
                    <label for="productName">Product Name:</label>
                    <input type="text" id="productName" name="productName" required autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="mixedDate">Mixed Date:</label>
                    <input type="date" id="mixedDate" name="mixedDate" required>
                </div>
                <div class="form-group">
                    <label for="productAmount">Number of Batches Produced:</label>
                    <input type="number" id="productAmount" name="productAmount" min="0" step="1" value="1" required>
                </div>
                <div class="form-group">
                    <label for="productGroup">Assign to Group:</label>
                    <select id="productGroup" name="productGroup">
                        <option value="">None</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="barcodeScanner">Scan Ingredient Barcode:</label>
                    <input type="text" id="barcodeScanner" name="barcodeScanner" placeholder="Scan or type barcode..." autocomplete="off">
                    <div class="barcode-status" id="barcodeStatus"></div>
                </div>
                <div class="form-group">
                    <label for="ingredientSelection">Select Ingredients:</label>
                    <div class="ingredient-selector" id="ingredientSelector"></div>
                </div>
                <div class="selected-ingredients" id="selectedIngredients"></div>
                <div class="form-actions">
                    <button type="button" class="modal-button cancel" onclick="closeProductModal()">Cancel</button>
                    <button type="submit" class="modal-button submit" id="submitProductButton">Add Product</button>
                </div>
            </form>
            <div class="barcode-result" id="barcodeResult" style="display: none;"></div>
        </div>
    </div>
    
    <!-- Ingredient Creation Modal -->
    <div class="modal-backdrop creation-modal-backdrop" id="ingredientModalBackdrop" onclick="closeIngredientModal()">
        <div class="modal-content creation-modal" id="ingredientModal" onclick="event.stopPropagation()">
            <button class="modal-close-button" onclick="closeIngredientModal()" title="Close">×</button>
            <h3>Add New Ingredient</h3>
            <form id="ingredientForm">
                <div class="form-group">
                    <label for="ingredientName">Ingredient Name:</label>
                    <input type="text" id="ingredientName" name="ingredientName" required autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="ingredientUnitCost">Unit Cost (per gram) ($):</label>
                    <input type="number" id="ingredientUnitCost" name="ingredientUnitCost" step="0.001" min="0" required>
                </div>
                <div class="form-group">
                    <label for="ingredientPurchaseDate">Purchase Date:</label>
                    <input type="date" id="ingredientPurchaseDate" name="ingredientPurchaseDate" required>
                </div>
                <div class="form-group">
                    <label for="ingredientExpirationDate">Expiration Date:</label>
                    <input type="date" id="ingredientExpirationDate" name="ingredientExpirationDate" required>
                </div>
                <div class="form-group">
                    <label for="ingredientSupplier">Supplier:</label>
                    <input type="text" id="ingredientSupplier" name="ingredientSupplier" required autocomplete="off">
                </div>
                <div class="form-actions">
                    <button type="button" class="modal-button cancel" onclick="closeIngredientModal()">Cancel</button>
                    <button type="submit" class="modal-button submit" id="submitIngredientButton">Add Ingredient</button>
                </div>
            </form>
            <div class="barcode-result" id="ingredientBarcodeResult" style="display: none;"></div>
        </div>
    </div>
    
    <!-- Group Creation Modal -->
    <div class="modal-backdrop creation-modal-backdrop" id="groupModalBackdrop" onclick="closeGroupModal()">
        <div class="modal-content creation-modal" id="groupModal" onclick="event.stopPropagation()">
            <button class="modal-close-button" onclick="closeGroupModal()" title="Close">×</button>
            <h3>Create New Group</h3>
            <form id="groupForm">
                <div class="form-group">
                    <label for="groupName">Group Name:</label>
                    <input type="text" id="groupName" name="groupName" required autocomplete="off" placeholder="Enter group name...">
                </div>
                <div class="form-actions">
                    <button type="button" class="modal-button cancel" onclick="closeGroupModal()">Cancel</button>
                    <button type="submit" class="modal-button submit" id="submitGroupButton">Create Group</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>

